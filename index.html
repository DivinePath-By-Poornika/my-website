<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astrology & Tarot Suite | Premium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <style>
    body {
      background: #0f172a;
      color: #f8fafc;
      font-family: 'Inter', sans-serif;
    }
    header {
      background: linear-gradient(90deg, #4f46e5, #9333ea);
      padding: 20px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      border-bottom: 2px solid #6366f1;
    }
    section {
      padding: 3rem 1rem;
      max-width: 900px;
      margin: 0 auto;
    }
    .card {
      background: #1e293b;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      margin-bottom: 2rem;
    }
    input, select, button {
      background: #0f172a;
      color: #f8fafc;
      border: 1px solid #334155;
      padding: 0.5rem;
      border-radius: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
    }
    button {
      background: #4f46e5;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #6366f1;
    }
    .tarot-card {
      display: inline-block;
      text-align: center;
      margin: 10px;
    }
    .tarot-card img {
      width: 100px;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    Astrology & Tarot Suite <br>
    <span class="text-sm">Part of Poornika Main Website</span>
  </header>

  <!-- Astrology Section -->
  <section>
    <h2 class="text-2xl font-bold mb-4 text-indigo-400">Astrology Calculator</h2>
    <div class="card">
      <input type="text" id="name" placeholder="Enter your Name">
      <input type="date" id="birthdate">
      <input type="time" id="birthtime">
      <input type="text" id="birthplace" placeholder="Enter Birthplace">
      <button onclick="calculateAstrology()">Calculate Astrology</button>
      <div id="astrology-result" class="mt-4 text-gray-300"></div>
    </div>
  </section>

  <!-- Numerology Section -->
  <section>
    <h2 class="text-2xl font-bold mb-4 text-indigo-400">Numerology Calculator</h2>
    <div class="card">
      <input type="text" id="num-name" placeholder="Enter your Name">
      <input type="date" id="num-birthdate">
      <button onclick="calculateNumerology()">Calculate Numerology</button>
      <div id="numerology-result" class="mt-4 text-gray-300"></div>
    </div>
  </section>

  <!-- Tarot Reading -->
  <section>
    <h2 class="text-2xl font-bold mb-4 text-indigo-400">Tarot Reading</h2>
    <div class="card">
      <input type="text" id="tarot-question" placeholder="Enter your question">
      <p class="mb-2">Choose Mode:</p>
      <label><input type="radio" name="tarot-mode" value="offline" checked> Offline</label>
      <label><input type="radio" name="tarot-mode" value="freeAI"> Free AI</label>
      <label><input type="radio" name="tarot-mode" value="openai"> OpenAI</label>
      <p class="mb-2 mt-4">Select Spread:</p>
      <select id="tarot-spread">
        <option value="basic">Basic (3 Cards)</option>
        <option value="celtic-cross">Celtic Cross (10 Cards)</option>
        <option value="relationship">Relationship (6 Cards)</option>
        <option value="career">Career (5 Cards)</option>
      </select>
      <button onclick="drawTarot()">Draw Tarot Cards</button>
      <div id="tarot-result" class="mt-4 text-gray-300"></div>
      <div id="tarot-cards" class="mt-4"></div>
    </div>
  </section>

  <!-- GSAP Animations -->
  <script>
    gsap.registerPlugin(ScrollTrigger);
    gsap.from("header", { y: -100, duration: 1, ease: "power4.out" });
    gsap.from("section h2", {
      scrollTrigger: { trigger: "section h2", start: "top 90%" },
      y: 50, opacity: 0, duration: 1, stagger: 0.3
    });
    gsap.from("section div", {
      scrollTrigger: { trigger: "section div", start: "top 85%" },
      opacity: 0, y: 30, duration: 1, stagger: 0.2
    });
  </script>

  <!-- Main JS Logic -->
  <script>
    /* ---------------------------
       1. ASTROLOGY CALCULATOR
    ---------------------------- */
    async function calculateAstrology() {
      const name = document.getElementById('name').value;
      const birthdate = document.getElementById('birthdate').value;
      const birthtime = document.getElementById('birthtime').value;
      const birthplace = document.getElementById('birthplace').value;

      const resultDiv = document.getElementById('astrology-result');
      resultDiv.innerHTML = "<p class='text-gray-400'>Calculating...</p>";

      try {
        // Auto location coordinates
        let coords = { lat: null, lon: null };
        if (birthplace) {
          const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(birthplace)}`);
          const geoData = await geoRes.json();
          if (geoData && geoData.length > 0) {
            coords.lat = geoData[0].lat;
            coords.lon = geoData[0].lon;
          }
        }

        const signIndex = new Date(birthdate).getMonth(); 
        const signs = ["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];
        const sign = signs[signIndex % 12];

        resultDiv.innerHTML = `
          <h3 class="text-xl font-bold mb-2 text-indigo-400">Astrology Report</h3>
          <p>Name: ${name}</p>
          <p>Date of Birth: ${birthdate}</p>
          <p>Time: ${birthtime}</p>
          <p>Place: ${birthplace}</p>
          <p>Sun Sign: ${sign}</p>
          <p><em>Coordinates:</em> ${coords.lat ? coords.lat + ", " + coords.lon : "Not found"}</p>
        `;
      } catch (error) {
        resultDiv.innerHTML = "<p class='text-red-400'>Error in calculation</p>";
      }
    }

    /* ---------------------------
       2. NUMEROLOGY CALCULATOR
    ---------------------------- */
    function calculateNumerology() {
      const name = document.getElementById('num-name').value.toUpperCase();
      const birthdate = document.getElementById('num-birthdate').value;

      const resultDiv = document.getElementById('numerology-result');
      resultDiv.innerHTML = "<p class='text-gray-400'>Calculating...</p>";

      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      let nameValue = 0;
      for (let char of name) {
        let pos = letters.indexOf(char);
        if (pos !== -1) nameValue += (pos % 9) + 1;
      }

      let lifePath = birthdate.replace(/-/g,"").split("").reduce((a,b)=>a+parseInt(b),0);
      while (lifePath > 9) lifePath = lifePath.toString().split("").reduce((a,b)=>a+parseInt(b),0);

      resultDiv.innerHTML = `
        <h3 class="text-xl font-bold mb-2 text-indigo-400">Numerology Report</h3>
        <p>Expression Number: ${reduceToSingleDigit(nameValue)}</p>
        <p>Life Path Number: ${lifePath}</p>
        <p>Destiny Number: ${reduceToSingleDigit(nameValue + lifePath)}</p>
      `;
    }

    function reduceToSingleDigit(num) {
      while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
        num = num.toString().split("").reduce((a,b)=>a+parseInt(b),0);
      }
      return num;
    }

    /* ---------------------------
       3. TAROT READING
    ---------------------------- */
    const tarotDeck = [
      "The Fool","The Magician","The High Priestess","The Empress","The Emperor",
      "The Hierophant","The Lovers","The Chariot","Strength","The Hermit",
      "Wheel of Fortune","Justice","The Hanged Man","Death","Temperance",
      "The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"
    ];

    function drawTarot() {
      const question = document.getElementById('tarot-question').value;
      const mode = document.querySelector('input[name="tarot-mode"]:checked').value;
      const spread = document.getElementById('tarot-spread').value;
      const tarotResult = document.getElementById('tarot-result');
      const tarotCardsDiv = document.getElementById('tarot-cards');
      
      tarotResult.innerHTML = "<p class='text-gray-400'>Drawing cards...</p>";
      tarotCardsDiv.innerHTML = "";

      let count = 3;
      if (spread === "celtic-cross") count = 10;
      else if (spread === "relationship") count = 6;
      else if (spread === "career") count = 5;

      const selectedCards = [];
      for (let i = 0; i < count; i++) {
        const randomIndex = Math.floor(Math.random() * tarotDeck.length);
        selectedCards.push(tarotDeck[randomIndex]);
      }

      if (mode === "offline") {
        tarotResult.innerHTML = `<p class='text-indigo-400 font-bold'>Offline Reading:</p><p>${basicTarotInterpretation(selectedCards, question)}</p>`;
      } else {
        tarotResult.innerHTML = `<p class='text-gray-400'>Fetching AI interpretation...</p>`;
        fetchAIInterpretation(selectedCards, question, mode).then(response => {
          tarotResult.innerHTML = `<p class='text-indigo-400 font-bold'>AI Reading:</p><p>${response}</p>`;
        }).catch(() => {
          tarotResult.innerHTML = "<p class='text-red-400'>AI API failed. Showing offline interpretation.</p><p>" + basicTarotInterpretation(selectedCards, question) + "</p>";
        });
      }

      selectedCards.forEach(card => {
        tarotCardsDiv.innerHTML += `
          <div class="tarot-card">
            <img src="https://www.sacred-texts.com/tarot/pkt/img/${card.toLowerCase().replace(/ /g,'')}.jpg" alt="${card}">
            <p class="text-sm">${card}</p>
          </div>
        `;
      });
    }

    function basicTarotInterpretation(cards, question) {
      return `Your question: ${question}. Cards drawn: ${cards.join(", ")}. This spread suggests important insights about your situation.`;
    }

    async function fetchAIInterpretation(cards, question, mode) {
      if (mode === "freeAI") {
        // Mock free API response
        return `Free AI: Based on your question "${question}" and cards [${cards.join(", ")}], the reading suggests transformation and new opportunities.`;
      } else if (mode === "openai") {
        // Placeholder (replace with real OpenAI API logic)
        return `OpenAI: Detailed interpretation for "${question}" with cards [${cards.join(", ")}].`;
      }
    }
  </script>
</body>
</html>
