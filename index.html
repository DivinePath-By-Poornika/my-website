<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Astrology & Tarot - Premium</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(120deg, #1a1a1a, #2d2d2d);
  color: white;
}
.card {
  background: #1f1f1f;
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  padding: 20px;
  margin-bottom: 20px;
}
.tarot-card {
  width: 120px;
  height: 200px;
  background: #333;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 10px;
  transition: transform 0.4s ease;
}
.tarot-card:hover {
  transform: scale(1.1);
}
.tarot-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.animate-fade {
  animation: fadeIn 1s ease-in-out;
}
@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}
</style>
</head>
<body class="p-6">
<h1 class="text-4xl text-center font-bold mb-8 text-yellow-400">Astrology + Tarot & Numerology</h1>

<!-- ASTROLOGY SECTION -->
<div class="card">
  <h2 class="text-2xl font-semibold mb-4">Astrology Calculator</h2>
  <input id="name" placeholder="Full Name" class="p-2 mb-2 w-full rounded bg-gray-800">
  <input id="birthdate" type="date" class="p-2 mb-2 w-full rounded bg-gray-800">
  <input id="birthtime" type="time" class="p-2 mb-2 w-full rounded bg-gray-800">
  <input id="birthplace" placeholder="Birth Place" class="p-2 mb-2 w-full rounded bg-gray-800">
  <button onclick="calculateAstrology()" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded">Calculate</button>
  <div id="astrology-result" class="mt-4 text-gray-200"></div>
</div>

<!-- NUMEROLOGY SECTION -->
<div class="card">
  <h2 class="text-2xl font-semibold mb-4">Numerology Calculator</h2>
  <input id="num-name" placeholder="Full Name" class="p-2 mb-2 w-full rounded bg-gray-800">
  <input id="num-birthdate" type="date" class="p-2 mb-2 w-full rounded bg-gray-800">
  <button onclick="calculateNumerology()" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded">Calculate</button>
  <div id="numerology-result" class="mt-4 text-gray-200"></div>
</div>

<!-- TAROT SECTION -->
<div class="card">
  <h2 class="text-2xl font-semibold mb-4">Tarot Reading</h2>
  <input id="tarot-question" placeholder="Your Question" class="p-2 mb-2 w-full rounded bg-gray-800">
  <div class="mb-4">
    <label class="mr-4"><input type="radio" name="tarot-mode" value="offline" checked> Offline Mode</label>
    <label><input type="radio" name="tarot-mode" value="ai"> AI Mode</label>
  </div>
  <input id="api-key" placeholder="Enter OpenAI API Key (for AI mode)" class="p-2 mb-4 w-full rounded bg-gray-800">
  
  <select id="spread-type" class="p-2 mb-4 w-full rounded bg-gray-800">
    <option value="3">3-Card Spread</option>
    <option value="celtic">Celtic Cross</option>
    <option value="career">Career Spread</option>
    <option value="relationship">Relationship Spread</option>
  </select>

  <button onclick="drawTarot()" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded">Draw Cards</button>
  
  <div id="tarot-cards" class="flex flex-wrap mt-6"></div>
  <div id="tarot-result" class="mt-4 text-gray-200"></div>
</div>

<script>
/* -------------------------
    AUTO-LOCATION FUNCTION
------------------------- */
async function getUserLocation() {
  return new Promise((resolve) => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        resolve({lat: pos.coords.latitude, lon: pos.coords.longitude});
      }, () => {
        resolve({lat: 28.6139, lon: 77.2090}); // Default: Delhi
      });
    } else {
      resolve({lat: 28.6139, lon: 77.2090});
    }
  });
}

/* -------------------------
    ASTROLOGY CALCULATOR
------------------------- */
async function calculateAstrology() {
  const name = document.getElementById('name').value.trim();
  const birthdate = document.getElementById('birthdate').value;
  const birthtime = document.getElementById('birthtime').value;
  const birthplace = document.getElementById('birthplace').value;

  if (!name || !birthdate || !birthtime || !birthplace) {
    document.getElementById('astrology-result').innerHTML = "<p class='text-red-400'>Please fill all fields.</p>";
    return;
  }

  const {lat, lon} = await getUserLocation();
  const sunSign = getSunSign(birthdate);
  const dasha = getVimshottariDasha(birthdate);

  document.getElementById('astrology-result').innerHTML = `
    <h4 class="text-yellow-400 text-xl font-semibold">Astrology Report</h4>
    <p><b>Name:</b> ${name}</p>
    <p><b>Date:</b> ${birthdate}, Time: ${birthtime}</p>
    <p><b>Place:</b> ${birthplace}</p>
    <p><b>Detected Coords:</b> ${lat.toFixed(2)}, ${lon.toFixed(2)}</p>
    <p><b>Sun Sign:</b> ${sunSign}</p>
    <p><b>Current Dasha:</b> ${dasha}</p>
  `;
}

function getSunSign(dateStr) {
  const date = new Date(dateStr);
  const day = date.getUTCDate();
  const month = date.getUTCMonth() + 1;

  const signs = [
    {sign: "Capricorn", start: [12, 22], end: [1, 19]},
    {sign: "Aquarius", start: [1, 20], end: [2, 18]},
    {sign: "Pisces", start: [2, 19], end: [3, 20]},
    {sign: "Aries", start: [3, 21], end: [4, 19]},
    {sign: "Taurus", start: [4, 20], end: [5, 20]},
    {sign: "Gemini", start: [5, 21], end: [6, 20]},
    {sign: "Cancer", start: [6, 21], end: [7, 22]},
    {sign: "Leo", start: [7, 23], end: [8, 22]},
    {sign: "Virgo", start: [8, 23], end: [9, 22]},
    {sign: "Libra", start: [9, 23], end: [10, 22]},
    {sign: "Scorpio", start: [10, 23], end: [11, 21]},
    {sign: "Sagittarius", start: [11, 22], end: [12, 21]}
  ];

  for (const s of signs) {
    if ((month === s.start[0] && day >= s.start[1]) || (month === s.end[0] && day <= s.end[1])) {
      return s.sign;
    }
  }
  return "Unknown";
}

function getVimshottariDasha(birthdate) {
  const start = new Date(birthdate);
  const now = new Date();
  const yearsPassed = (now - start) / (1000 * 60 * 60 * 24 * 365);
  const dashas = ["Ketu", "Venus", "Sun", "Moon", "Mars", "Rahu", "Jupiter", "Saturn", "Mercury"];
  const index = Math.floor((yearsPassed / 120) * dashas.length) % dashas.length;
  return dashas[index];
}

/* -------------------------
    NUMEROLOGY
------------------------- */
function calculateNumerology() {
  const name = document.getElementById('num-name').value.trim();
  const birthdate = document.getElementById('num-birthdate').value;

  if (!name || !birthdate) {
    document.getElementById('numerology-result').innerHTML = "<p class='text-red-400'>Please fill all fields.</p>";
    return;
  }

  const lifePath = getLifePathNumber(birthdate);
  const destiny = getDestinyNumber(name);
  const soulUrge = getSoulUrgeNumber(name);

  document.getElementById('numerology-result').innerHTML = `
    <h4 class="text-yellow-400 text-xl font-semibold">Numerology Report</h4>
    <p><b>Name:</b> ${name}</p>
    <p><b>Birthdate:</b> ${birthdate}</p>
    <p><b>Life Path Number:</b> ${lifePath}</p>
    <p><b>Destiny Number:</b> ${destiny}</p>
    <p><b>Soul Urge Number:</b> ${soulUrge}</p>
  `;
}

function reduceToSingleDigit(num) {
  while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
    num = num.toString().split("").reduce((a, b) => a + parseInt(b), 0);
  }
  return num;
}

function getLifePathNumber(dateStr) {
  const nums = dateStr.split("-").join("").split("").map(Number);
  return reduceToSingleDigit(nums.reduce((a, b) => a + b, 0));
}

function getDestinyNumber(name) {
  const letters = name.toUpperCase().replace(/[^A-Z]/g, "");
  let sum = 0;
  for (let ch of letters) {
    sum += (ch.charCodeAt(0) - 64);
  }
  return reduceToSingleDigit(sum);
}

function getSoulUrgeNumber(name) {
  const vowels = "AEIOU";
  const letters = name.toUpperCase().replace(/[^A-Z]/g, "");
  let sum = 0;
  for (let ch of letters) {
    if (vowels.includes(ch)) sum += (ch.charCodeAt(0) - 64);
  }
  return reduceToSingleDigit(sum);
}

/* -------------------------
    TAROT READING
------------------------- */
const tarotDeck = [
  "The Fool", "The Magician", "The High Priestess", "The Empress", "The Emperor",
  "The Hierophant", "The Lovers", "The Chariot", "Strength", "The Hermit",
  "Wheel of Fortune", "Justice", "The Hanged Man", "Death", "Temperance",
  "The Devil", "The Tower", "The Star", "The Moon", "The Sun", "Judgement", "The World"
];

async function drawTarot() {
  const question = document.getElementById('tarot-question').value.trim();
  const mode = document.querySelector('input[name="tarot-mode"]:checked').value;
  const spread = document.getElementById('spread-type').value;
  const apiKey = document.getElementById('api-key').value.trim();

  if (!question) {
    document.getElementById('tarot-result').innerHTML = "<p class='text-red-400'>Please enter your question.</p>";
    return;
  }

  let count = spread === "3" ? 3 : spread === "celtic" ? 10 : 5;
  const cards = pickRandomCards(count);

  renderTarotCards(cards);
  document.getElementById('tarot-result').innerHTML = `<p class="text-green-400">Spread: ${spread.toUpperCase()} | Cards: ${cards.join(", ")}</p>`;

  if (mode === "ai" && apiKey) {
    const aiInterpretation = await getAIInterpretation(apiKey, question, cards, spread);
    document.getElementById('tarot-result').innerHTML += `<p><b>AI Interpretation:</b> ${aiInterpretation}</p>`;
  }
}

function pickRandomCards(n) {
  const shuffled = tarotDeck.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, n);
}

function renderTarotCards(cards) {
  const container = document.getElementById('tarot-cards');
  container.innerHTML = "";
  cards.forEach(c => {
    const imgSrc = `https://raw.githubusercontent.com/ekelen/tarot-api/master/cards/${encodeURIComponent(c)}.jpg`;
    const div = document.createElement('div');
    div.className = "tarot-card animate-fade";
    div.innerHTML = `<img src="${imgSrc}" alt="${c}" onerror="this.src='https://via.placeholder.com/120x200?text=${c}'">`;
    container.appendChild(div);
  });
}

async function getAIInterpretation(apiKey, question, cards, spread) {
  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: "gpt-4",
        messages: [
          {role: "system", content: "You are an expert tarot reader."},
          {role: "user", content: `Question: ${question}\nSpread: ${spread}\nCards: ${cards.join(", ")}\nGive a detailed interpretation.`}
        ]
      })
    });
    const data = await response.json();
    return data.choices?.[0]?.message?.content || "AI interpretation not available.";
  } catch (err) {
    return "Error fetching AI interpretation.";
  }
}
</script>
</body>
</html>
